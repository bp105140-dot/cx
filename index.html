<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard WhatsApp CX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="header">
      <div class="header-logo">
        <div class="icon">ğŸ’¬</div>
        <div>
          <div class="header-title">CX <span> King Star ColchÃµes </span></div>
        </div>
      </div>
      <div
        class="header-meta"
        style="display: flex; align-items: center; gap: 12px"
      >
        <span
          ><strong id="hdr-total">â€”</strong> tickets Â·
          <strong id="hdr-period">â€”</strong></span
        >
        <button
          class="btn-import"
          onclick="document.getElementById('csv-input').click()"
        >
          ğŸ“‚ Importar CSV
        </button>
        <input
          type="file"
          id="csv-input"
          accept=".csv"
          style="display: none"
          onchange="handleCSVImport(event)"
        />
      </div>
    </div>

    <div class="tabs-bar">
      <button class="tab-btn active" onclick="switchTab('aba1')">
        ğŸ“Š VisÃ£o Executiva
      </button>
      <button class="tab-btn" onclick="switchTab('aba2')">
        â±ï¸ SLA &amp; EficiÃªncia
      </button>
      <button class="tab-btn" onclick="switchTab('aba3')">
        ğŸ‘©â€ğŸ’¼ Performance da Equipe
      </button>
      <button class="tab-btn" onclick="switchTab('aba4')">
        ğŸ“ Motivos &amp; Causas
      </button>
      <button class="tab-btn" onclick="switchTab('aba5')">
        ğŸ”¥ AnÃ¡lise Operacional
      </button>
      <button class="btn-labels" id="btn-labels" onclick="toggleLabels()">
        <span class="lbl-dot"></span> RÃ³tulos: OFF
      </button>
    </div>

    <div class="filters-bar">
      <div class="filter-group">
        <span class="filter-label">MÃªs</span>
        <select id="f-month" onchange="applyFilters()">
          <option value="">Todos</option>
          <option value="Janeiro">Janeiro</option>
          <option value="Fevereiro">Fevereiro</option>
        </select>
      </div>
      <div class="filter-group">
        <span class="filter-label">Agente</span>
        <select id="f-agent" onchange="applyFilters()">
          <option value="">Todos</option>
        </select>
      </div>
      <div class="filter-group">
        <span class="filter-label">Status</span>
        <select id="f-status" onchange="applyFilters()">
          <option value="">Todos</option>
          <option value="Closed">Closed</option>
          <option value="Solved">Solved</option>
        </select>
      </div>
      <div class="filter-group">
        <span class="filter-label">Motivo</span>
        <select id="f-motivo" onchange="applyFilters()">
          <option value="">Todos</option>
          <option value="INFORMAÃ‡ÃƒO">INFORMAÃ‡ÃƒO</option>
          <option value="SOLICITAÃ‡ÃƒO">SOLICITAÃ‡ÃƒO</option>
          <option value="RECLAMAÃ‡ÃƒO">RECLAMAÃ‡ÃƒO</option>
        </select>
      </div>
      <div class="filter-group">
        <span class="filter-label">TabulaÃ§Ã£o</span>
        <select id="f-tab" onchange="applyFilters()">
          <option value="">Todas</option>
        </select>
      </div>
      <div class="filter-group">
        <span class="filter-label">Dia da Semana</span>
        <select id="f-day" onchange="applyFilters()">
          <option value="">Todos</option>
        </select>
      </div>
      <div class="filter-group">
        <span class="filter-label">De</span>
        <input type="date" id="f-date-from" onchange="applyFilters()" />
      </div>
      <div class="filter-group">
        <span class="filter-label">AtÃ©</span>
        <input type="date" id="f-date-to" onchange="applyFilters()" />
      </div>
      <button class="btn-clear" onclick="clearFilters()">âœ• Limpar</button>
    </div>

    <!-- EMPTY STATE -->
    <div id="empty-state" class="empty-state" style="display: none">
      <div class="empty-icon">ğŸ“Š</div>
      <h2>Nenhum dado carregado</h2>
      <p>
        Importe um arquivo CSV para visualizar o dashboard. O arquivo deve
        conter os dados de tickets exportados do sistema.
      </p>
      <div class="csv-hint">
        <div style="margin-bottom: 8px; font-weight: 600; color: var(--text)">
          Colunas esperadas no CSV:
        </div>
        <strong>dt</strong> (data), <strong>mo</strong> (mÃªs),
        <strong>dw</strong> (dia semana), <strong>hr</strong> (hora),
        <strong>id</strong>, <strong>st</strong> (status),
        <strong>ch</strong> (canal), <strong>ag</strong> (agente),
        <strong>ci</strong> (cliente), <strong>mt</strong> (motivo),
        <strong>tb</strong> (tabulaÃ§Ã£o), <strong>fr</strong> (first reply min),
        <strong>tr</strong> (tempo resoluÃ§Ã£o), <strong>ar</strong> (agente
        response)
      </div>
      <button
        class="btn-import-sm"
        onclick="document.getElementById('csv-input').click()"
      >
        ğŸ“‚ Importar CSV
      </button>
    </div>

    <!-- IMPORT TOAST -->
    <div id="import-toast" class="import-toast">
      <span id="toast-msg">âœ… Dados importados com sucesso!</span>
    </div>

    <!-- ABA 1: VISÃƒO EXECUTIVA -->
    <div id="aba1" class="tab-content active">
      <div class="page">
        <div class="section-title">KPIs Principais</div>
        <div class="kpi-grid">
          <div class="kpi-card" style="--accent-color: #00d4ff">
            <span class="kpi-icon">ğŸ«</span>
            <div class="kpi-value" id="kpi-total">â€”</div>
            <div class="kpi-label">Total de Tickets</div>
            <div class="kpi-sub" id="kpi-total-sub">â€”</div>
          </div>
          <div class="kpi-card" style="--accent-color: #10b981">
            <span class="kpi-icon">âœ…</span>
            <div class="kpi-value" id="kpi-closed-pct">â€”</div>
            <div class="kpi-label">Taxa de Fechamento</div>
            <div class="kpi-sub" id="kpi-closed-sub">â€”</div>
          </div>
          <div class="kpi-card" style="--accent-color: #f59e0b">
            <span class="kpi-icon">ğŸ“…</span>
            <div class="kpi-value" id="kpi-daily-avg">â€”</div>
            <div class="kpi-label">MÃ©dia DiÃ¡ria</div>
            <div class="kpi-sub">tickets/dia</div>
          </div>
          <div class="kpi-card" style="--accent-color: #7c3aed">
            <span class="kpi-icon">â±ï¸</span>
            <div class="kpi-value" id="kpi-fr-avg">â€”</div>
            <div class="kpi-label">1Âª Resposta MÃ©dia</div>
            <div class="kpi-sub">minutos</div>
          </div>
          <div class="kpi-card" style="--accent-color: #ef4444">
            <span class="kpi-icon">ğŸ”„</span>
            <div class="kpi-value" id="kpi-tr-avg">â€”</div>
            <div class="kpi-label">ResoluÃ§Ã£o MÃ©dia</div>
            <div class="kpi-sub">minutos</div>
          </div>
          <div class="kpi-card" style="--accent-color: #06b6d4">
            <span class="kpi-icon">ğŸ‘¥</span>
            <div class="kpi-value" id="kpi-clients">â€”</div>
            <div class="kpi-label">Clientes Ãšnicos</div>
            <div class="kpi-sub" id="kpi-recurrent">â€”</div>
          </div>
          <div class="kpi-card" style="--accent-color: #f97316">
            <span class="kpi-icon">ğŸ”</span>
            <div class="kpi-value" id="kpi-recurrent-pct">â€”</div>
            <div class="kpi-label">Taxa ReincidÃªncia</div>
            <div class="kpi-sub">clientes c/ +1 ticket</div>
          </div>
          <div class="kpi-card" style="--accent-color: #a855f7">
            <span class="kpi-icon">ğŸ†</span>
            <div class="kpi-value" id="kpi-sla5">â€”</div>
            <div class="kpi-label">SLA â‰¤ 5 min</div>
            <div class="kpi-sub">primeira resposta</div>
          </div>
        </div>

        <div class="charts-grid">
          <div class="chart-card chart-full">
            <div class="chart-title">
              ğŸ“ˆ Volume por Data
              <span class="badge" id="vol-badge">Carregando...</span>
            </div>
            <div class="chart-wrap tall">
              <canvas id="chart-volume-day"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸ“Š DistribuiÃ§Ã£o de Status</div>
            <div class="chart-wrap"><canvas id="chart-status"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸ“ Volume por MÃªs</div>
            <div class="chart-wrap"><canvas id="chart-month"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸ• Volume por Dia da Semana</div>
            <div class="chart-wrap"><canvas id="chart-dayofweek"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸ’¬ Motivo do Contato</div>
            <div class="chart-wrap">
              <canvas id="chart-motivo-pie"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ABA 2: SLA & EFICIÃŠNCIA -->
    <div id="aba2" class="tab-content">
      <div class="page">
        <div class="section-title">Tempo de Primeira Resposta</div>
        <div class="kpi-grid">
          <div class="kpi-card" style="--accent-color: #00d4ff">
            <span class="kpi-icon">âš¡</span>
            <div class="kpi-value" id="sla-fr-avg">â€”</div>
            <div class="kpi-label">MÃ©dia FR (min)</div>
          </div>
          <div class="kpi-card" style="--accent-color: #10b981">
            <span class="kpi-icon">ğŸ“</span>
            <div class="kpi-value" id="sla-fr-med">â€”</div>
            <div class="kpi-label">Mediana FR (min)</div>
          </div>
          <div class="kpi-card" style="--accent-color: #f59e0b">
            <span class="kpi-icon">ğŸ¯</span>
            <div class="kpi-value" id="sla-fr-5">â€”</div>
            <div class="kpi-label">% em â‰¤5 min</div>
          </div>
          <div class="kpi-card" style="--accent-color: #7c3aed">
            <span class="kpi-icon">âœ…</span>
            <div class="kpi-value" id="sla-fr-15">â€”</div>
            <div class="kpi-label">% em â‰¤15 min</div>
          </div>
        </div>

        <div class="section-title">Faixas de Primeira Resposta</div>
        <div class="sla-faixas">
          <div class="sla-faixa">
            <div class="faixa-val" id="fr-faixa-0-5" style="color: #10b981">
              â€”
            </div>
            <div class="faixa-label">0â€“5 min</div>
          </div>
          <div class="sla-faixa">
            <div class="faixa-val" id="fr-faixa-5-15" style="color: #f59e0b">
              â€”
            </div>
            <div class="faixa-label">5â€“15 min</div>
          </div>
          <div class="sla-faixa">
            <div class="faixa-val" id="fr-faixa-15-60" style="color: #f97316">
              â€”
            </div>
            <div class="faixa-label">15â€“60 min</div>
          </div>
          <div class="sla-faixa">
            <div class="faixa-val" id="fr-faixa-60p" style="color: #ef4444">
              â€”
            </div>
            <div class="faixa-label">+60 min</div>
          </div>
        </div>

        <div class="charts-grid" style="margin-top: 16px">
          <div class="chart-card">
            <div class="chart-title">âš¡ DistribuiÃ§Ã£o 1Âª Resposta (faixas)</div>
            <div class="chart-wrap"><canvas id="chart-fr-dist"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-title">
              ğŸ”„ DistribuiÃ§Ã£o ResoluÃ§Ã£o Total (faixas)
            </div>
            <div class="chart-wrap"><canvas id="chart-tr-dist"></canvas></div>
          </div>
        </div>

        <div class="section-title" style="margin-top: 4px">
          Tempo Total de ResoluÃ§Ã£o
        </div>
        <div class="kpi-grid">
          <div class="kpi-card" style="--accent-color: #ef4444">
            <span class="kpi-icon">â³</span>
            <div class="kpi-value" id="sla-tr-avg">â€”</div>
            <div class="kpi-label">MÃ©dia ResoluÃ§Ã£o (min)</div>
          </div>
          <div class="kpi-card" style="--accent-color: #a855f7">
            <span class="kpi-icon">ğŸ“</span>
            <div class="kpi-value" id="sla-tr-med">â€”</div>
            <div class="kpi-label">Mediana (min)</div>
          </div>
          <div class="kpi-card" style="--accent-color: #00d4ff">
            <span class="kpi-icon">âš¡</span>
            <div class="kpi-value" id="sla-tr-4h">â€”</div>
            <div class="kpi-label">% em â‰¤4h</div>
          </div>
          <div class="kpi-card" style="--accent-color: #10b981">
            <span class="kpi-icon">ğŸ</span>
            <div class="kpi-value" id="sla-ar-avg">â€”</div>
            <div class="kpi-label">Atribâ†’ResoluÃ§Ã£o (min)</div>
          </div>
        </div>

        <div class="charts-grid">
          <div class="chart-card">
            <div class="chart-title">ğŸ“ˆ EvoluÃ§Ã£o Mensal: FR e TR MÃ©dio</div>
            <div class="chart-wrap"><canvas id="chart-sla-trend"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸ—“ï¸ FR MÃ©dio por Dia da Semana</div>
            <div class="chart-wrap">
              <canvas id="chart-fr-dayofweek"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ABA 3: PERFORMANCE DA EQUIPE -->
    <div id="aba3" class="tab-content">
      <div class="page">
        <div class="section-title">Ranking de Agentes</div>
        <div class="chart-card">
          <div class="chart-title">ğŸ† Volume por Agente</div>
          <div class="chart-wrap tall">
            <canvas id="chart-agent-vol"></canvas>
          </div>
        </div>
        <div class="charts-grid" style="margin-top: 16px">
          <div class="chart-card">
            <div class="chart-title">
              âš¡ Tempo MÃ©dio 1Âª Resposta por Agente (min)
            </div>
            <div class="chart-wrap tall">
              <canvas id="chart-agent-fr"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-title">
              â³ Tempo MÃ©dio de ResoluÃ§Ã£o por Agente (min)
            </div>
            <div class="chart-wrap tall">
              <canvas id="chart-agent-tr"></canvas>
            </div>
          </div>
        </div>

        <div class="section-title">Tabela Detalhada de Agentes</div>
        <div class="chart-card">
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th onclick="sortTable('agent-table', 1)">Agente â‡…</th>
                  <th onclick="sortTable('agent-table', 2)">Tickets â‡…</th>
                  <th onclick="sortTable('agent-table', 3)">% Total â‡…</th>
                  <th onclick="sortTable('agent-table', 4)">FR MÃ©dio â‡…</th>
                  <th onclick="sortTable('agent-table', 5)">TR MÃ©dio â‡…</th>
                  <th onclick="sortTable('agent-table', 6)">FR Mediana â‡…</th>
                  <th onclick="sortTable('agent-table', 7)">TR Mediana â‡…</th>
                </tr>
              </thead>
              <tbody id="agent-table"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ABA 4: MOTIVOS & CAUSAS -->
    <div id="aba4" class="tab-content">
      <div class="page">
        <div class="section-title">DistribuiÃ§Ã£o de Motivos</div>
        <div class="charts-grid">
          <div class="chart-card">
            <div class="chart-title">ğŸ“Š Motivo do Contato</div>
            <div class="chart-wrap">
              <canvas id="chart-motivo-bar"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸ—‚ï¸ TabulaÃ§Ã£o (Ãrea)</div>
            <div class="chart-wrap"><canvas id="chart-tab-bar"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸ“¦ Submotivos: Pedidos</div>
            <div class="chart-wrap">
              <canvas id="chart-sub-pedidos"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸšš Submotivos: OcorrÃªncia na Entrega</div>
            <div class="chart-wrap">
              <canvas id="chart-sub-entrega"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸ”§ Submotivos: AssistÃªncia TÃ©cnica</div>
            <div class="chart-wrap">
              <canvas id="chart-sub-assist"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸ’¬ Submotivos: Atendimento</div>
            <div class="chart-wrap"><canvas id="chart-sub-atend"></canvas></div>
          </div>
        </div>

        <div class="section-title">AnÃ¡lise de Pareto (80/20)</div>
        <div class="chart-card">
          <div class="chart-title">âš–ï¸ Pareto â€” TabulaÃ§Ã£o + Submotivo</div>
          <div id="pareto-list"></div>
        </div>

        <div class="charts-grid" style="margin-top: 16px">
          <div class="chart-card">
            <div class="chart-title">ğŸ“… Motivos por MÃªs</div>
            <div class="chart-wrap">
              <canvas id="chart-motivo-month"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ğŸ“… TabulaÃ§Ã£o por MÃªs</div>
            <div class="chart-wrap"><canvas id="chart-tab-month"></canvas></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ABA 5: ANÃLISE OPERACIONAL -->
    <div id="aba5" class="tab-content">
      <div class="page">
        <div class="section-title">
          Heatmap: Volume por Hora x Dia da Semana
        </div>
        <div class="chart-card">
          <div id="heatmap-volume"></div>
        </div>

        <div class="section-title" style="margin-top: 16px">
          Heatmap: Tempo MÃ©dio 1Âª Resposta por Hora x Dia
        </div>
        <div class="chart-card">
          <div id="heatmap-fr"></div>
        </div>

        <div class="charts-grid" style="margin-top: 16px">
          <div class="chart-card">
            <div class="chart-title">ğŸ• Volume por Hora do Dia</div>
            <div class="chart-wrap"><canvas id="chart-hour-vol"></canvas></div>
          </div>
          <div class="chart-card">
            <div class="chart-title">âš¡ FR MÃ©dio por Hora</div>
            <div class="chart-wrap"><canvas id="chart-hour-fr"></canvas></div>
          </div>
        </div>

        <div class="section-title">Top 10 Clientes Recorrentes</div>
        <div class="chart-card">
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>ID do Cliente</th>
                  <th>Total Tickets</th>
                  <th>Motivos Principais</th>
                </tr>
              </thead>
              <tbody id="top-clients-table"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script src="dashboard.js"></script>
  </body>
</html>
